package com.example.examplemod.Module.EXPLOIT;

import com.example.examplemod.ExampleMod;
import com.example.examplemod.Module.Module;
import net.minecraft.client.Minecraft;
import net.minecraft.client.gui.FontRenderer;
import net.minecraft.client.gui.ScaledResolution;
import net.minecraft.entity.monster.EntityZombie;
import net.minecraftforge.client.event.RenderGameOverlayEvent;
import net.minecraftforge.event.entity.living.LivingDeathEvent;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import org.lwjgl.input.Keyboard;
import yea.bushroot.clickgui.Setting;

import java.util.HashSet;
import java.util.Set;

public class ScoreZombie extends Module {

    private int zombieKillCount = 0;
    private final Set<Integer> deadZombies = new HashSet<>();


    private Setting posXSetting;
    private Setting posYSetting;
    private Setting colorSetting;

    public ScoreZombie() {
        super("ScoreZombie", Keyboard.KEY_NONE, Category.EXPLOIT);


        posXSetting = new Setting("PosX", this, 450, 0, 1000, true);
        posYSetting = new Setting("PosY", this, 10, 0, 1000, true);
        colorSetting = new Setting("Color", this, 0x00FF00, 0x000000, 0xFFFFFF, true);

        ExampleMod.instance.settingsManager.rSetting(posXSetting);
        ExampleMod.instance.settingsManager.rSetting(posYSetting);
        ExampleMod.instance.settingsManager.rSetting(colorSetting);
    }

    @Override
    public void onEnable() {
        super.onEnable();
        zombieKillCount = 0;
        deadZombies.clear();
        System.out.println("ScoreZombie enabled!");
    }

    @Override
    public void onDisable() {
        super.onDisable();
        System.out.println("ScoreZombie disabled!");
    }

    @SubscribeEvent
    public void onEntityDeath(LivingDeathEvent event) {

        if (event.getEntity() instanceof EntityZombie) {
            int entityId = event.getEntity().getEntityId();


            if (!deadZombies.contains(entityId)) {
                deadZombies.add(entityId);
                zombieKillCount++;
                System.out.println("Zombie killed! Total: " + zombieKillCount);
            } else {
                System.out.println("Zombie already counted! Entity ID: " + entityId);
            }
        }
    }

    @SubscribeEvent
    public void onRenderGameOverlay(RenderGameOverlayEvent.Post event) {
        if (event.getType() != RenderGameOverlayEvent.ElementType.TEXT) return;
        Minecraft mc = Minecraft.getMinecraft();
        FontRenderer fontRenderer = mc.fontRenderer;
        ScaledResolution scaledResolution = new ScaledResolution(mc);
        String text = "Убито зомби: " + zombieKillCount;
        int posX = (int) posXSetting.getValDouble();
        int posY = (int) posYSetting.getValDouble();
        int textColor = (int) colorSetting.getValDouble();
        fontRenderer.drawStringWithShadow(text, posX, posY, textColor);
    }
}