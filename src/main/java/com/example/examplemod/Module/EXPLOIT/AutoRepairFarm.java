package com.example.examplemod.Module.EXPLOIT;

import com.example.examplemod.Module.Module;
import com.example.examplemod.ExampleMod;
import net.minecraft.item.ItemStack;
import net.minecraft.item.ItemSword;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import net.minecraftforge.fml.common.gameevent.TickEvent;
import org.lwjgl.input.Keyboard;
import yea.bushroot.clickgui.Setting;

public class AutoRepairFarm extends Module {
    private int tickTimer = 0;

    public AutoRepairFarm() {
        super("AutoRepairFarm", Keyboard.KEY_NONE, Category.EXPLOIT);
        ExampleMod.instance.settingsManager.rSetting(new Setting("DurabilityThreshold", this, 150.0, 50.0, 300.0, true));
    }

    @SubscribeEvent
    public void onClientTick(TickEvent.ClientTickEvent event) {
        if (!this.isEnabled()) return;

        ++this.tickTimer;


        for (int i = 0; i < mc.player.inventory.getSizeInventory(); i++) {
            ItemStack itemStack = mc.player.inventory.getStackInSlot(i);


            if (itemStack.getItem() instanceof ItemSword && itemStack.getItem().getRegistryName().toString().equals("minecraft:diamond_sword")) {

                Setting durabilitySetting = ExampleMod.instance.settingsManager.getSettingByName(this.getName(), "DurabilityThreshold");
                if (durabilitySetting != null) {
                    double durabilityThreshold = durabilitySetting.getValDouble();


                    if ((double) itemStack.getItemDamage() > durabilityThreshold && this.tickTimer >= 20) {

                        mc.player.sendChatMessage("/repair all");
                        this.tickTimer = 0;
                        break;
                    }
                } else {
                    System.err.println("Настройка DurabilityThreshold не найдена!");
                }
            }
        }


        if (this.tickTimer >= 20) {
            this.tickTimer = 0;
        }
    }
}