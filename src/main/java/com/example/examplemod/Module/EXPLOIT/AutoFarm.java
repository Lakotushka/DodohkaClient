package com.example.examplemod.Module.EXPLOIT;

import com.example.examplemod.ExampleMod;
import com.example.examplemod.Module.Module;
import net.minecraft.client.Minecraft;
import net.minecraft.entity.item.EntityItem;
import net.minecraft.entity.item.EntityItemFrame;
import net.minecraft.init.Items;
import net.minecraft.item.Item;
import net.minecraft.item.ItemStack;
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent;
import net.minecraftforge.fml.common.gameevent.TickEvent;
import org.lwjgl.input.Keyboard;
import yea.bushroot.clickgui.Setting;

import java.awt.*;
import java.awt.event.InputEvent;
import java.util.List;

public class AutoFarm extends Module {

    public AutoFarm() {
        super("AutoFarm", Keyboard.KEY_NONE, Category.EXPLOIT);
        ExampleMod.instance.settingsManager.rSetting(new Setting("Rotation", this, 50.0, 0.0, 90.0, true));
    }

    private final Minecraft mc = Minecraft.getMinecraft();
    private Robot robot;
    private int clickCounter = 0;
    private boolean isClicking = false;
    private int tickCounter = 0;
    private float originalPitch = 0.0F;

    {
        try {
            robot = new Robot();
        } catch (AWTException e) {
            e.printStackTrace();
        }
    }

    @SubscribeEvent
    public void onPlayerTick(TickEvent.PlayerTickEvent event) {
        if (!this.isEnabled() || robot == null || mc.player == null || mc.world == null) return;


        if (tickCounter % 10 == 0) {
            if (checkForDrops()) {

                if (!isClicking) {
                    isClicking = true;
                    clickCounter = 0;


                    originalPitch = mc.player.rotationPitch;


                    Setting pitchSetting = ExampleMod.instance.settingsManager.getSettingByName(this.getName(), "Rotation");
                    if (pitchSetting != null) {
                        double pitchAngle = pitchSetting.getValDouble();
                        mc.player.rotationPitch = (float) pitchAngle;
                    }
                }
            } else {

                if (isClicking) {

                    mc.player.rotationPitch = originalPitch;
                }
                isClicking = false;
            }
        }
        tickCounter++;


        if (isClicking && clickCounter < 12) {
            robot.mousePress(InputEvent.BUTTON1_DOWN_MASK);
            robot.mouseRelease(InputEvent.BUTTON1_DOWN_MASK);


            mc.player.rotationYaw += 36.0F;

            clickCounter++;


            if (clickCounter < 12) {

            }
        } else {
            isClicking = false;
        }
    }

    private boolean checkForDrops() {

        List<EntityItem> items = mc.world.getEntitiesWithinAABB(EntityItem.class, mc.player.getEntityBoundingBox().grow(10));


        for (EntityItem item : items) {
            Item itemType = item.getItem().getItem();
            if (itemType == Items.GOLD_INGOT || itemType == Items.DIAMOND || itemType == Items.IRON_INGOT || itemType == Items.EMERALD) {
                return true;
            }
        }


        List<EntityItemFrame> frames = mc.world.getEntitiesWithinAABB(EntityItemFrame.class, mc.player.getEntityBoundingBox().grow(10));


        for (EntityItemFrame frame : frames) {
            ItemStack frameItem = frame.getDisplayedItem();
            if (!frameItem.isEmpty()) {
                Item itemType = frameItem.getItem();
                if (itemType == Items.GOLD_INGOT || itemType == Items.DIAMOND || itemType == Items.IRON_INGOT || itemType == Items.EMERALD) {
                    return true;
                }
            }
        }

        return false;
    }
}